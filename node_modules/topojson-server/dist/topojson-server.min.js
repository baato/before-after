// https://github.com/topojson/topojson-server Version 3.0.0. Copyright 2017 Mike Bostock.
!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(n.topojson=n.topojson||{})}(this,function(n){"use strict";function r(n,r,e,o){t(n,r,e),t(n,r,r+o),t(n,r+o,e)}function t(n,r,t){for(var e,o=r+(t---r>>1);r<o;++r,--t)e=n[r],n[r]=n[t],n[t]=e}function e(n){return null==n?{type:null}:("FeatureCollection"===n.type?o:"Feature"===n.type?i:u)(n)}function o(n){var r={type:"GeometryCollection",geometries:n.features.map(i)};return null!=n.bbox&&(r.bbox=n.bbox),r}function i(n){var r,t=u(n.geometry);null!=n.id&&(t.id=n.id),null!=n.bbox&&(t.bbox=n.bbox);for(r in n.properties){t.properties=n.properties;break}return t}function u(n){if(null==n)return{type:null};var r="GeometryCollection"===n.type?{type:"GeometryCollection",geometries:n.geometries.map(u)}:"Point"===n.type||"MultiPoint"===n.type?{type:n.type,coordinates:n.coordinates}:{type:n.type,arcs:n.coordinates};return null!=n.bbox&&(r.bbox=n.bbox),r}function a(n){var r,t=n[0],e=n[1];return e<t&&(r=t,t=e,e=r),t+31*e}function f(n,r){var t,e=n[0],o=n[1],i=r[0],u=r[1];return o<e&&(t=e,e=o,o=t),u<i&&(t=i,i=u,u=t),e===i&&o===u}var c=function(n){function r(n){null!=n&&c.hasOwnProperty(n.type)&&c[n.type](n)}function t(n){var r=n[0],t=n[1];r<i&&(i=r),r>a&&(a=r),t<u&&(u=t),t>f&&(f=t)}function e(n){n.forEach(t)}function o(n){n.forEach(e)}var i=1/0,u=1/0,a=-1/0,f=-1/0,c={GeometryCollection:function(n){n.geometries.forEach(r)},Point:function(n){t(n.coordinates)},MultiPoint:function(n){n.coordinates.forEach(t)},LineString:function(n){e(n.arcs)},MultiLineString:function(n){n.arcs.forEach(e)},Polygon:function(n){n.arcs.forEach(e)},MultiPolygon:function(n){n.arcs.forEach(o)}};for(var l in n)r(n[l]);return a>=i&&f>=u?[i,u,a,f]:void 0},l=function(n,r,t,e,o){function i(e){for(var i=r(e)&c,u=f[i],a=0;u!=o;){if(t(u,e))return!0;if(++a>=n)throw new Error("full hashset");u=f[i=i+1&c]}return f[i]=e,!0}function u(e){for(var i=r(e)&c,u=f[i],a=0;u!=o;){if(t(u,e))return!0;if(++a>=n)break;u=f[i=i+1&c]}return!1}function a(){for(var n=[],r=0,t=f.length;r<t;++r){var e=f[r];e!=o&&n.push(e)}return n}3===arguments.length&&(e=Array,o=null);for(var f=new e(n=1<<Math.max(4,Math.ceil(Math.log(n)/Math.LN2))),c=n-1,l=0;l<n;++l)f[l]=o;return{add:i,has:u,values:a}},s=function(n,r,t,e,o,i){function u(e,i){for(var u=r(e)&h,a=l[u],f=0;a!=o;){if(t(a,e))return s[u]=i;if(++f>=n)throw new Error("full hashmap");a=l[u=u+1&h]}return l[u]=e,s[u]=i,i}function a(e,i){for(var u=r(e)&h,a=l[u],f=0;a!=o;){if(t(a,e))return s[u];if(++f>=n)throw new Error("full hashmap");a=l[u=u+1&h]}return l[u]=e,s[u]=i,i}function f(e,i){for(var u=r(e)&h,a=l[u],f=0;a!=o;){if(t(a,e))return s[u];if(++f>=n)break;a=l[u=u+1&h]}return i}function c(){for(var n=[],r=0,t=l.length;r<t;++r){var e=l[r];e!=o&&n.push(e)}return n}3===arguments.length&&(e=i=Array,o=null);for(var l=new e(n=1<<Math.max(4,Math.ceil(Math.log(n)/Math.LN2))),s=new i(n),h=n-1,g=0;g<n;++g)l[g]=o;return{set:u,maybeSet:a,get:f,keys:c}},h=function(n,r){return n[0]===r[0]&&n[1]===r[1]},g=new ArrayBuffer(16),p=new Float64Array(g),v=new Uint32Array(g),y=function(n){p[0]=n[0],p[1]=n[1];var r=v[0]^v[1];return 2147483647&(r=r<<5^r>>7^v[2]^v[3])},d=function(n){function r(n,r,t,e){if(d[t]!==n){d[t]=n;var o=m[t];if(o>=0){var i=b[t];o===r&&i===e||o===e&&i===r||(++M,w[t]=1)}else m[t]=r,b[t]=e}}function t(n){return y(c[n])}function e(n,r){return h(c[n],c[r])}var o,i,u,a,f,c=n.coordinates,g=n.lines,p=n.rings,v=function(){for(var n=s(1.4*c.length,t,e,Int32Array,-1,Int32Array),r=new Int32Array(c.length),o=0,i=c.length;o<i;++o)r[o]=n.maybeSet(o,o);return r}(),d=new Int32Array(c.length),m=new Int32Array(c.length),b=new Int32Array(c.length),w=new Int8Array(c.length),M=0;for(o=0,i=c.length;o<i;++o)d[o]=m[o]=b[o]=-1;for(o=0,i=g.length;o<i;++o){var x=g[o],P=x[0],A=x[1];for(a=v[P],f=v[++P],++M,w[a]=1;++P<=A;)r(o,u=a,a=f,f=v[P]);++M,w[f]=1}for(o=0,i=c.length;o<i;++o)d[o]=-1;for(o=0,i=p.length;o<i;++o){var E=p[o],L=E[0]+1,S=E[1];for(u=v[S-1],a=v[L-1],f=v[L],r(o,u,a,f);++L<=S;)r(o,u=a,a=f,f=v[L])}d=m=b=null;var C,G=l(1.4*M,y,h);for(o=0,i=c.length;o<i;++o)w[C=v[o]]&&G.add(c[C]);return G},m=function(n){var t,e,o,i=d(n),u=n.coordinates,a=n.lines,f=n.rings;for(e=0,o=a.length;e<o;++e)for(var c=a[e],l=c[0],s=c[1];++l<s;)i.has(u[l])&&(t={0:l,1:c[1]},c[1]=l,c=c.next=t);for(e=0,o=f.length;e<o;++e)for(var h=f[e],g=h[0],p=g,v=h[1],y=i.has(u[g]);++p<v;)i.has(u[p])&&(y?(t={0:p,1:h[1]},h[1]=p,h=h.next=t):(r(u,g,v,v-p),u[v]=u[g],y=!0,p=g));return n},b=function(n){function r(n){var r,o,i,u,a,f,c,l;if(i=m.get(r=g[n[0]]))for(c=0,l=i.length;c<l;++c)if(u=i[c],t(u,n))return n[0]=u[0],void(n[1]=u[1]);if(a=m.get(o=g[n[1]]))for(c=0,l=a.length;c<l;++c)if(f=a[c],e(f,n))return n[1]=f[0],void(n[0]=f[1]);i?i.push(n):m.set(r,[n]),a?a.push(n):m.set(o,[n]),b.push(n)}function t(n,r){var t=n[0],e=r[0],o=n[1];if(t-o!=e-r[1])return!1;for(;t<=o;++t,++e)if(!h(g[t],g[e]))return!1;return!0}function e(n,r){var t=n[0],e=r[0],o=n[1],i=r[1];if(t-o!=e-i)return!1;for(;t<=o;++t,--i)if(!h(g[t],g[i]))return!1;return!0}function o(n,r){var t=n[0],e=r[0],o=n[1],i=r[1],a=o-t;if(a!==i-e)return!1;for(var f=u(n),c=u(r),l=0;l<a;++l)if(!h(g[t+(l+f)%a],g[e+(l+c)%a]))return!1;return!0}function i(n,r){var t=n[0],e=r[0],o=n[1],i=r[1],a=o-t;if(a!==i-e)return!1;for(var f=u(n),c=a-u(r),l=0;l<a;++l)if(!h(g[t+(l+f)%a],g[i-(l+c)%a]))return!1;return!0}function u(n){for(var r=n[0],t=n[1],e=r,o=e,i=g[e];++e<t;){var u=g[e];(u[0]<i[0]||u[0]===i[0]&&u[1]<i[1])&&(o=e,i=u)}return o-r}var a,f,c,l,g=n.coordinates,p=n.lines,v=n.rings,d=p.length+v.length;for(delete n.lines,delete n.rings,c=0,l=p.length;c<l;++c)for(a=p[c];a=a.next;)++d;for(c=0,l=v.length;c<l;++c)for(f=v[c];f=f.next;)++d;var m=s(2*d*1.4,y,h),b=n.arcs=[];for(c=0,l=p.length;c<l;++c){a=p[c];do{r(a)}while(a=a.next)}for(c=0,l=v.length;c<l;++c)if(f=v[c],f.next)do{r(f)}while(f=f.next);else!function(n){var r,t,e,a,f;if(t=m.get(r=g[n[0]]))for(a=0,f=t.length;a<f;++a){if(e=t[a],o(e,n))return n[0]=e[0],void(n[1]=e[1]);if(i(e,n))return n[0]=e[1],void(n[1]=e[0])}if(t=m.get(r=g[n[0]+u(n)]))for(a=0,f=t.length;a<f;++a){if(e=t[a],o(e,n))return n[0]=e[0],void(n[1]=e[1]);if(i(e,n))return n[0]=e[1],void(n[1]=e[0])}t?t.push(n):m.set(r,[n]),b.push(n)}(f);return n},w=function(n){for(var r=-1,t=n.length;++r<t;){for(var e,o,i=n[r],u=0,a=1,f=i.length,c=i[0],l=c[0],s=c[1];++u<f;)c=i[u],e=c[0],o=c[1],e===l&&o===s||(i[a++]=[e-l,o-s],l=e,s=o);1===a&&(i[a++]=[0,0]),i.length=a}return n},M=function(n){function r(n){n&&c.hasOwnProperty(n.type)&&c[n.type](n)}function t(n){for(var r=0,t=n.length;r<t;++r)f[++i]=n[r];var e={0:i-t+1,1:i};return u.push(e),e}function e(n){for(var r=0,t=n.length;r<t;++r)f[++i]=n[r];var e={0:i-t+1,1:i};return a.push(e),e}function o(n){return n.map(e)}var i=-1,u=[],a=[],f=[],c={GeometryCollection:function(n){n.geometries.forEach(r)},LineString:function(n){n.arcs=t(n.arcs)},MultiLineString:function(n){n.arcs=n.arcs.map(t)},Polygon:function(n){n.arcs=n.arcs.map(e)},MultiPolygon:function(n){n.arcs=n.arcs.map(o)}};for(var l in n)r(n[l]);return{type:"Topology",coordinates:f,lines:u,rings:a,objects:n}},x=function(n){var r,t={};for(r in n)t[r]=e(n[r]);return t},P=function(n,r,t){function e(n){return[Math.round((n[0]-c)*g),Math.round((n[1]-l)*p)]}function o(n,r){for(var t,e,o,i,u,a=-1,f=0,s=n.length,h=new Array(s);++a<s;)t=n[a],i=Math.round((t[0]-c)*g),u=Math.round((t[1]-l)*p),i===e&&u===o||(h[f++]=[e=i,o=u]);for(h.length=f;f<r;)f=h.push([h[0][0],h[0][1]]);return h}function i(n){return o(n,2)}function u(n){return o(n,4)}function a(n){return n.map(u)}function f(n){null!=n&&v.hasOwnProperty(n.type)&&v[n.type](n)}var c=r[0],l=r[1],s=r[2],h=r[3],g=s-c?(t-1)/(s-c):1,p=h-l?(t-1)/(h-l):1,v={GeometryCollection:function(n){n.geometries.forEach(f)},Point:function(n){n.coordinates=e(n.coordinates)},MultiPoint:function(n){n.coordinates=n.coordinates.map(e)},LineString:function(n){n.arcs=i(n.arcs)},MultiLineString:function(n){n.arcs=n.arcs.map(i)},Polygon:function(n){n.arcs=a(n.arcs)},MultiPolygon:function(n){n.arcs=n.arcs.map(a)}};for(var y in n)f(n[y]);return{scale:[1/g,1/p],translate:[c,l]}},A=function(n,r){function t(n){n&&p.hasOwnProperty(n.type)&&p[n.type](n)}function e(n){var r=[];do{var t=g.get(n);r.push(n[0]<n[1]?t:~t)}while(n=n.next);return r}function o(n){return n.map(e)}var i=c(n=x(n)),u=r>0&&i&&P(n,i,r),l=b(m(M(n))),h=l.coordinates,g=s(1.4*l.arcs.length,a,f);n=l.objects,l.bbox=i,l.arcs=l.arcs.map(function(n,r){return g.set(n,r),h.slice(n[0],n[1]+1)}),delete l.coordinates,h=null;var p={GeometryCollection:function(n){n.geometries.forEach(t)},LineString:function(n){n.arcs=e(n.arcs)},MultiLineString:function(n){n.arcs=n.arcs.map(e)},Polygon:function(n){n.arcs=n.arcs.map(e)},MultiPolygon:function(n){n.arcs=n.arcs.map(o)}};for(var v in n)t(n[v]);return u&&(l.transform=u,l.arcs=w(l.arcs)),l};n.topology=A,Object.defineProperty(n,"__esModule",{value:!0})});